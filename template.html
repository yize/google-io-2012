<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mahé <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
-->
<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
    <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
    <!--This one seems to work all the time, but really small on ipad-->
    <!--<meta name="viewport" content="initial-scale=0.4">-->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="stylesheet" media="all" href="theme/css/default.css">
    <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css">
    <base target="_blank">
    <!-- This amazingness opens all links in a new tab. -->
    <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

<slide class="logoslide nobackground">
    <article class="flexbox vcenter">
        <span><img src="images/google_developers_logo.png"></span>
    </article>
</slide>

<slide class="title-slide segue nobackground">
    <aside class="gdbar"><img src="images/google_developers_icon_128.png"></aside>
    <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
        <h1 data-config-title><!-- populated from slide_config.json --></h1>

        <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>

        <p data-config-presenter><!-- populated from slide_config.json --></p>
    </hgroup>
</slide>

<slide>
    <hgroup>
        <h2>Connect是什么？</h2>
    </hgroup>
    <article>
        <p>它是什么？</p>
        <ul class="build">
            <li>
                它是Node的一个中间件框架
            </li>
            <li>
                <del>18</del>22个捆绑的中间件和一些精选第三方中间件
            </li>
        </ul>
        <p>特点：</p>
        <ul class="build">
            <li>模型简单</li>
            <li>中间件易于组合和插拔</li>
            <li>中间件易于定制和优化</li>
            <li>丰富的中间件</li>
        </ul>
    </article>
</slide>
<slide>
    <hgroup>
        <h2></h2>
    </hgroup>
    <article>
        <p>让我们先来看一个最简单的Web服务器的代码</p>
    </article>
    <pre class="prettyprint" data-lang="javascript">
        var http = require('http');
        http.createServer(function (req, res) {
            //在这里我们可以做很多事情
            res.writeHead(200, {'Content-Type': 'text/plain'});
            res.end('Hello World\n');
        }).listen(1337, '127.0.0.1');
        console.log('Server running at http://127.0.0.1:1337/');
    </pre>
        <p>HTTP模块处理网络访问有两个重要的因素</p>
        <p>请求和响应</p>
        <p>connect的中间件做的就是处理请求</p><br>
        <p>让下一个中间件继续处理</p>
        <p>或者响应客户端</p>
</slide>

<slide>
    <hgroup>
        <h2>中间件</h2>
    </hgroup>
    <article>
        <pre class="prettyprint" data-lang="javascript">
            /**
             *
             * @param req 请求对象
             * @param res 响应对象
             * @param next 下一个中间件
             */
            function (req, res, next) {
                // 中间件
            }
        </pre>
        <p>中间件一般不会调用res.end()方法</p>
    </article>
</slide>

<slide>
    <hgroup>
        <h2>流式处理</h2>
    </hgroup>
    <article>
        <pre class="prettyprint" data-lang="javascript">
            var connect = require('connect');
            var app = connect();
            // 中间件队列
            app.use(connect.staticCache());
            app.use(connect.static(__dirname + '/public'));
            app.use(connect.cookieParser());
            app.use(connect.session());
            app.use(connect.query());
            app.use(connect.bodyParser());
            app.use(connect.csrf());
            app.use(function (req, res, next) {
                // 中间件
            });
            app.listen(3030);
        </pre>
        <p>Conncet提供use方法用于注册中间件到一个Connect对象的队列中，我们称该队列叫做中间件队列。</p>
    </article>
</slide>

<slide>
    <hgroup>
        <h2>Connect:use</h2>
    </hgroup>
    <article>
        <pre class="prettyprint" data-lang="javascript">
            app.stack = [];
            app.use = function(route, fn){
              // …

              // add the middleware
              debug('use %s %s', route || '/', fn.name || 'anonymous');
              this.stack.push({ route: route, handle: fn });

              return this;
            };
        </pre>
    </article>
</slide>

<slide>
    <hgroup>
        <h2>Connect:use</h2>
    </hgroup>
    <article>
        <pre class="prettyprint" data-lang="javascript">
            app.use = function(route, fn){
                //默认路径是'/'
                if ('string' != typeof route) {
                    fn = route;
                    route = '/';
                }

                // wrap sub-apps
                if ('function' == typeof fn.handle) {
                    var server = fn;
                    fn.route = route;
                    fn = function(req, res, next){
                      server.handle(req, res, next);
                    };
                }
            ...
            }
        </pre>
    </article>
</slide>

<slide>
    <hgroup>
        <h2>路由</h2>
    </hgroup>
    <article>
        <ul>
            <li>app.use方法默认接收两个参数：route和fn，如果route没有传入的话，默认是'/'</li>
            <li>路由信息的作用是过滤不匹配的URL</li>
            <li>请求在遇见路由信息不匹配时，直接传递给下一个中间件处理。</li>
            <li>建议指定route，减少性能损耗</li>
        </ul>
    </article>
</slide>

<slide>
    <article class="smaller">
        <ul>
            <ul>
                <li><a href="http://www.senchalabs.org/connect/logger.html">logger</a> request logger with custom format support</li>
                <li><a href="http://www.senchalabs.org/connect/csrf.html">csrf</a> Cross-site request forgery protection</li>
                <li><a href="http://www.senchalabs.org/connect/compress.html">compress</a> Gzip compression middleware</li>
                <li><a href="http://www.senchalabs.org/connect/basicAuth.html">basicAuth</a> basic http authentication</li>
                <li><a href="http://www.senchalabs.org/connect/bodyParser.html">bodyParser</a> extensible request body parser</li>
                <li><a href="http://www.senchalabs.org/connect/json.html">json</a> application/json parser</li>
                <li><a href="http://www.senchalabs.org/connect/urlencoded.html">urlencoded</a> application/x-www-form-urlencoded parser</li>
                <li><a href="http://www.senchalabs.org/connect/multipart.html">multipart</a> multipart/form-data parser</li>
                <li><a href="http://www.senchalabs.org/connect/timeout.html">timeout</a> request timeouts</li>
                <li><a href="http://www.senchalabs.org/connect/cookieParser.html">cookieParser</a> cookie parser</li>
                <li><a href="http://www.senchalabs.org/connect/session.html">session</a> session management support with bundled MemoryStore</li>
                <li><a href="http://www.senchalabs.org/connect/cookieSession.html">cookieSession</a> cookie-based session support</li>
                <li><a href="http://www.senchalabs.org/connect/methodOverride.html">methodOverride</a> faux HTTP method support</li>
                <li><a href="http://www.senchalabs.org/connect/responseTime.html">responseTime</a> calculates response-time and exposes via X-Response-Time</li>
                <li><a href="http://www.senchalabs.org/connect/staticCache.html">staticCache</a> memory cache layer for the static() middleware</li>
                <li><a href="http://www.senchalabs.org/connect/static.html">static</a> streaming static file server supporting <code>Range</code> and more</li>
                <li><a href="http://www.senchalabs.org/connect/directory.html">directory</a> directory listing middleware</li>
                <li><a href="http://www.senchalabs.org/connect/vhost.html">vhost</a> virtual host sub-domain mapping middleware</li>
                <li><a href="http://www.senchalabs.org/connect/favicon.html">favicon</a> efficient favicon server (with default icon)</li>
                <li><a href="http://www.senchalabs.org/connect/limit.html">limit</a> limit the bytesize of request bodies</li>
                <li><a href="http://www.senchalabs.org/connect/query.html">query</a> automatic querystring parser, populating <code>req.query</code></li>
                <li><a href="http://www.senchalabs.org/connect/errorHandler.html">errorHandler</a> flexible error handler</li>
            </ul>
        </ul>
    </article>
</slide>

<slide>
    <hgroup>
        <h2>static</h2>
    </hgroup>
    <article>
        <pre class="prettyprint" data-lang="javascript">
        var oneDay = 86400000;

        connect()
        .use(connect.static(__dirname + '/public'))

        connect()
        .use(connect.static(__dirname + '/public', { maxAge: oneDay }))
        </pre>
        <p>静态文件放在一个目录，这样就可以通过/static/去找到静态文件</p>
    </article>
</slide>

<slide>
	<hgroup><h2>CONNECT API</h2></hgroup>
	<article>
		<iframe data-src="http://www.senchalabs.org/connect/"></iframe>
	</article>
</slide>

<slide hidden>
	<hgroup>
		<h2>logger</h2>
	</hgroup>
	<article>
        <pre class="prettyprint" data-lang="javascript">
		connect()
			.use(connect.logger())
			.listen(3000);
        </pre>
		<p>静态文件放在一个目录，这样就可以通过/static/去找到静态文件</p>
	</article>
</slide>

<slide hidden>
	<hgroup>
		<h2>logger</h2>
	</hgroup>
	<article>
        <pre class="prettyprint" data-lang="javascript">
		var app = connect()
			.use(connect.logger())
			.listen(3000);
        </pre>
		<p>fast</p>
		<pre class='prettyprint' data-lang="javascript">
		connect()
			.use(connect.logger({buffer:5000}))
			.use(connect.favicon())
			.listen(3000);
		</pre>
		<code>buffer</code>:缓冲周期
	</article>
</slide>

<slide hidden>
	<hgroup>
		<h2>logger format</h2>
	</hgroup>
	<article>
        <pre class="prettyprint" data-lang="javascript">
		connect()
		.use(connect.logger(':method :url - :res[content-type]'))
		.use(function(req,res){
			res.statusCode = 500;
			res.setHeader('Content-Type', 'text/plain');
			res.end('Internal Server Error');
		})
		.listen(3000)
        </pre>
	</article>
</slide>

<slide hidden>
    <hgroup>
        <h2>Query</h2>
    </hgroup>
    <article>
        <pre class="prettyprint" data-lang="javascript">
            connect()
            .use(connect.query())
            .use(function(req, res){
                res.end(JSON.stringify(req.query));
            });
        </pre>
    </article>
</slide>

<slide>
    <hgroup>
        <h2>nodejsmodule.org</h2>
    </hgroup>
    <article>
        <iframe data-src="https://nodejsmodules.org/"></iframe>
    </article>
</slide>

<slide class="fill nobackground" style="background-image: url(images/pai.jpg)">
    <hgroup>
        <h2 class="white">要做一个应用，感觉用connect还是有点复杂，怎么办</h2>
    </hgroup>
</slide>
<slide class="fill nobackground" style="background-image: url(images/pai2.jpg)">
    <hgroup>
        <h2 class="white">新大陆！！</h2>
    </hgroup>
</slide>

<slide>
    <hgroup>
        <h2>Express</h2>
    </hgroup>
    <article>
        <pre class="prettyprint" data-lang="javascript">
            var express = require('express');
            var app = express();

            app.get('/', function(req, res){
              res.send('Hello World');
            });

            app.listen(3000);
        </pre>
    </article>
</slide>

<slide>
    <hgroup>
        <h2>特点</h2>
    </hgroup>
    <article>
        <ul>
            <li>基于Connect</li>
            <li>强大的路由</li>
            <li>HTTP插件(重定向、缓存等)</li>
            <li>View层支持14种以上的模版引擎</li>
            <li>基于Connect</li>
        </ul>
	    <p><a href="http://expressjs.com/">express</a></p>
	    <p><a href="http://expressjs.jser.us/">express中文文档</a></p>
    </article>
</slide>

<slide class="thank-you-slide segue nobackground">
    <aside class="gdbar right"><img src="images/google_developers_icon_128.png"></aside>
    <article class="flexbox vleft auto-fadein">
        <h2>&lt;Thank You!&gt;</h2>

        <p>yize.shc@gmail.com.</p>
    </article>
    <p class="auto-fadein" data-config-contact>
        <!-- populated from slide_config.json -->
    </p>
</slide>

<slide class="logoslide dark nobackground">
    <article class="flexbox vcenter">
        <span><img src="images/google_developers_logo_white.png"></span>
    </article>
</slide>

<slide class="backdrop"></slide>

</slides>

<script>
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-XXXXXXXX-1']);
    _gaq.push(['_trackPageview']);

    (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
    })();
</script>

<!--[if IE]>
<script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
<script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>
